<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/font.css">
    <link rel="stylesheet" href="/static/css/xterm.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/font-awesome-css.min.css">
    <style>
        html,body{
            height: 100%;
        }

    </style>
</head>
<body style="width: 100% ; height: 100%">
<div id="terminal" style="width: 100% ; height: 100%"></div>
<script src="../static/js/jquery.min.js"></script>
<script src="../static/js/xterm.js"></script>
<script>
    $(function () {

        var wid = Math.round(document.body.clientWidth / 10);
        var hei = Math.round(document.body.clientHeight / 10);

        // HACK: This should be window.Terminal once upgraded to 4.0.1
        var term = new window.Terminal.Terminal({
            cols: wid,
            rows: hei,
            cursorBlink: 5,
            scrollback: 30,
            tabStopWidth: 4
        });
        term.open(document.getElementById('terminal'));

        function runFakeTerminal() {
            if (term._initialized) {
                return;
            }

            term._initialized = true;

            term.prompt = () => {
                term.write('\r\n$ ');
            };

            prompt(term);

            term.onKey(e => {
                const printable = !e.domEvent.altKey && !e.domEvent.altGraphKey && !e.domEvent.ctrlKey && !e.domEvent.metaKey;

                if (e.domEvent.keyCode === 13) {
                    prompt(term);

                } else if (e.domEvent.keyCode === 8) {
                    // Do not delete the prompt
                    if (term._core.buffer.x > 2) {
                        term.write('\b \b');
                    }
                } else if (printable) {
                    term.write(e.key);
                }
            });
        }

        function prompt(term) {
            term.write('\r\n');
            term.write('Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ')
        }

        var socket = new WebSocket('ws://127.0.0.1:8080/ws/v1');
        socket.onopen = function (){
            runFakeTerminal();

            socket.onmessage = function (msg) {
                console.log(msg);
                console.log(msg.data);
                term.write(msg.data);
            };
        }

    });
</script>

</body>

</html>